{% extends 'base.html' %}
{% load static %}

{% block styling %}{% endblock %}
{% block title %}Add Student{% endblock %}

{% block content %}

<!-- PAGE-HEADER -->
{% include 'partials/components/page-header.html' with page_title="Students Form" breadcrumb_item="User Management" %}
<!-- PAGE-HEADER END -->
<!-- 
<div class="container">
    <h2>Add Student</h2>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Add Student</button>
    </form>
</div> -->
<div class="row">
    <div class="col-xl-8">
        <div class="card custom-card">
            <div class="card-header justify-content-between">
                <div class="card-title">
                    Student Form
                </div>
                <span>
                    <a href="{% url 'user:student_list' %}" class="btn btn-primary btn-sm">View Students</a>
                </span>
            </div>
            <div class="card-body">
                <form method="POST" action="{% url 'user:student_create' %}" enctype="multipart/form-data" class="row g-3 mt-0" id="studentForm">
                    {% csrf_token %}
                    <div class="col-md-6">
                        <label class="form-label">First Name <span class="text-danger">*</span></label>
                        {{ form.first_name }}
                        {{ form.first_name.errors }}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Last Name <span class="text-danger">*</span></label>
                        {{ form.last_name }}
                        {{ form.last_name.errors }}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Middle Name</label>
                        {{ form.middle_name }}
                        {{ form.middle_name.errors }}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">DOB <span class="text-danger">*</span></label>
                        {{ form.date_of_birth }}
                        {{ form.date_of_birth.errors }}
                    </div>
                    <div class="col-md-6">
                        <label for="inputState" class="form-label">Gender <span class="text-danger">*</span></label>
                        {{ form.gender }}
                        {{ form.gender.errors }}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Enrollment Date <span class="text-danger">*</span></label>
                        {{ form.enrollment_date }}
                        {{ form.enrollment_date.errors }}
                    </div>
                    <div class="col-md-6">
                        <label for="inputEmail4" class="form-label">Email</label>
                        {{ form.email }}
                        {{ form.email.errors }}
                    </div>
                    <div class="col-md-6">
                        <label for="inputCity" class="form-label">Examination Number</label>
                        {{ form.examination_number }}
                        {{ form.examination_number.errors }}
                    </div>
                    <div class="mb-3">
                        <label for="formFile" class="form-label">Upload Student Photo <span
                                class="text-danger">*</span></label>
                        {{ form.image }}
                        {{ form.image.errors }}
                    </div>
                    <div class="col-12">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="gridCheck3">
                            <label class="form-check-label" for="gridCheck3">
                                Information is Correct
                            </label>
                        </div>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">Add Student</button>
                    </div>
                </form>
            </div>
            <div class="card-footer d-none border-top-0">
            </div>
        </div>
    </div>
    <div class="col-xl-4">
        <div class="card custom-card">
            <div class="card-header justify-content-between">
                <div class="card-title">
                    Important Information
                </div>

            </div>
            <div class="card-body">
                Kindly take note of the following information when adding a new student:
                <ol>
                    <li>Fields marked with an asterisk (<span class="text-danger">*</span>) are required.</li>
                    <li>The Image upload is required as important IDs like examination ID will use photo uploaded.</li>
                    <li>The student number will be generated automatically.</li>
                    <li>The Student username is generated automatically and will be used for login purposes. Default
                        username is <em>firstname-lastname</em>, Example is <b>chimweso-mukoko</b></li>
                    <li>The Student password will be generated automatically. Default password is
                        <em>FirstName@CurrentYear</em>, Example is <b>ChimwesoMukoko@2026</b>
                    </li>
                    <li>Ensure all information is correct before submitting the form.</li>
                </ol>
            </div>
            <div class="card-footer d-none border-top-0">
            </div>
        </div>
    </div>
</div>
{% endblock%}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("studentForm");

        form.addEventListener("submit", function (e) {
            let isValid = true;

            // Required fields (Django field IDs)
            const requiredFields = [
                "id_first_name",
                "id_last_name",
                "id_date_of_birth",
                "id_gender",
                "id_enrollment_date",
            ];

            requiredFields.forEach(id => {
                const field = document.getElementById(id);
                if (!field || field.value.trim() === "") {
                    field.classList.add("is-invalid");
                    isValid = false;
                } else {
                    field.classList.remove("is-invalid");
                }
            });

            // Checkbox validation
            const checkbox = document.getElementById("gridCheck3");
            if (!checkbox.checked) {
                checkbox.classList.add("is-invalid");
                isValid = false;
            } else {
                checkbox.classList.remove("is-invalid");
            }

            if (!isValid) {
                e.preventDefault(); // stop form submission
            }
        });
    });
</script>


{% block scripts %}{% endblock %}